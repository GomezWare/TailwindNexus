---
/**
 * This is the component page, it will show the component indicated in the url
 *
 * Needs a ID via Astro params URL
 */

import Layout from "../../layouts/Layout.astro";

import ComponentHeader from "../../components/component/ComponentHeader.astro";
import ComponentPreview from "../../components/component/ComponentPreview.astro";
import UserCard from "src/components/partials/cards/UserCard.astro";
import ComponentSharer from "src/components/component/ComponentSharer.astro";
import ComponentsComments from "src/components/component/ComponentsComments.astro";
import ComponerCommentCount from "src/components/component/ComponerCommentCount.astro";
import ComponentForm from "src/components/component/ComponentForm.astro";

// Get id via Astro params
const { id } = Astro.params;

// Fetch data from the API
const component = await fetch(Astro.url.origin + "/api/component/" + id).then(
  (data) => data.json()
);

// If the api returned a blank array (null response) redirect user to 404
if (component.length == 0) {
  return Astro.redirect("/404");
}
---

<Layout title="Component" footer={true}>
  <ComponentHeader name={component.name} description={component.description} />
  <UserCard
    id={component.user.id}
    username={component.user.name}
    avatar={component.user.avatar}
    totalComponents={component.user.totalComponents}
  />

  <ComponentPreview
    tailwind={component.tailwind}
    javascript={component.javascript}
  />
  <ComponentSharer id={id} />
  <ComponerCommentCount count={component.comments.length} />
  <ComponentForm />
  <ComponentsComments comments={component.comments} />
</Layout>
